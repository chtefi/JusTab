function htmlEncode(a){return document.createElement("a").appendChild(document.createTextNode(a)).parentNode.innerHTML}function createAlarms(){chrome.alarms.clearAll(function(){$.each(serviceData,function(a,b){!b.status||"sabnzbd"!=b.containerId&&"nzbget"!=b.containerId?b.status&&"couchpotato"==b.containerId?(chrome.alarms.create(b.snatched.alarmName,{periodInMinutes:b.refresh}),chrome.alarms.create(b.wanted.alarmName,{periodInMinutes:b.refresh})):b.status&&chrome.alarms.create(b.alarmName,{periodInMinutes:b.refresh}):(chrome.alarms.create(b.queue.alarmName,{periodInMinutes:b.queue.refresh}),chrome.alarms.create(b.history.alarmName,{periodInMinutes:b.history.refresh}))})})}function openOptions(){chrome.tabs.create({url:chrome.extension.getURL("options.html")+"#support"})}function createNotificaton(a,b){b||(b=function(){}),chrome.notifications.create(getNotificationId(),a,b)}function getNotificationId(){var a=Math.floor(9007199254740992*Math.random())+1;return a.toString()}Promise.all([serviceDataRefreshDone]).then(function(){moment.updateLocale("en",{calendar:{sameDay:"[Today]",nextDay:"[Tomorrow]",nextWeek:"dddd",lastDay:"[Yesterday]",lastWeek:"[Last] dddd",sameElse:"MMMM DD"}}),chrome.runtime.onStartup.addListener(function(){createAlarms()}),chrome.alarms.onAlarm.addListener(function(a){for(var b in serviceData)"sabnzbd"==serviceData[b].containerId||"nzbget"==serviceData[b].containerId?serviceData[b].queue.alarmName==a.name?window[serviceData[b].queue.bgFunctionName]():serviceData[b].history.alarmName==a.name&&window[serviceData[b].history.bgFunctionName]():"couchpotato"==serviceData[b].containerId?serviceData[b].snatched.alarmName==a.name?window[serviceData[b].snatched.bgFunctionName]():serviceData[b].wanted.alarmName==a.name&&window[serviceData[b].wanted.bgFunctionName]():serviceData[b].alarmName==a.name&&window[serviceData[b].bgFunctionName]()})}),chrome.runtime.onInstalled.addListener(function(a){createAlarms(),"install"==a.reason?openOptions():"update"==a.reason&&createNotificaton({type:"basic",title:"JusTab is updated",message:"Click here to see the changelog.",iconUrl:"../../img/app_icons/JusTab-128x128.png"},chrome.notifications.onClicked.addListener(function(){openOptions()}))});