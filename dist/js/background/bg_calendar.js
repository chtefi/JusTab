"use strict";function getCalendarData(a){serviceData.GC.status&&chrome.identity.getAuthToken({interactive:!0},function(b){var c,d=[],e=[];serviceData.GC.calendars.forEach(function(a,b){c=encodeURIComponent(a),d.push("https://www.googleapis.com/calendar/v3/calendars/"+c+"/events"),e.push(a)}),eventArray(d,e,b,a)})}function eventArray(a,b,c,d){var e,f=(new Date).toISOString(),g=serviceData.GC.days,h=moment(new Date).add(g,"days").endOf("day").toISOString(),i=[],j=[];a.forEach(function(a,d){e=a+"?&oauth_token="+c+"&timeMin="+f+"&timeMax="+h+"&orderBy=startTime&singleEvents=true",j.push(ajax("GET",e).then(function(a){a.items.forEach(function(a,c){a.calendarId=b[d]}),localStorage.setItem("Calendar_error",!1),serviceData.GC.error=!1,i=i.concat(a.items)},function(a){localStorage.setItem("Calendar_error",!0),serviceData.GC.error=!0}))}),Promise.all(j).then(function(){i.length>0&&(localStorage.setItem("Calendar",JSON.stringify(i)),serviceData.GC.JSON=i),calendarHTML(),d&&d()})}function calendarHTML(){var a,b=serviceData.GC.JSON.sort(sortCalendarResults),c="",d="";b.forEach(function(b,e){a=moment(b.start.dateTime||b.start.date).isBefore(moment(),"day")?"Today":moment(b.start.dateTime||b.start.date).calendar(),(moment(b.start.dateTime||b.start.date).isAfter(d,"day")||""===d)&&(c+="<h2>"+a+"</h2>"),d=moment(b.start.dateTime||b.start.date).isBefore(moment(),"day")?moment():moment(b.start.dateTime||b.start.date),c+='<div class="core-item gc-item"><div class="core-item-content">',b.start.dateTime?(eventStartTime=moment(b.start.dateTime).format("HH:mm"),eventEndTime=moment(b.end.dateTime).format("HH:mm"),c+=htmlEncode(eventStartTime+" - "+eventEndTime+" "+b.summary)):c+=htmlEncode(b.summary),c+='</div><div class="core-item-icon"></div></div><div class="gc-collapse core-collapse">',b.location&&(c+='<div class="gc-event-location">'+htmlEncode(b.location)+"</div>"),c+='<div class="gc-icon-container"><div class="waves-effect gc-event-remove-icon remove-icon" data-event-id='+b.id+" data-calendar-id="+b.calendarId+'></div><a class="gc-event-link" href="'+b.htmlLink+'" target="_blank"><div class="waves-effect gc-event-link-icon edit-icon"></div></a></div></div>'}),localStorage.setItem("CalendarHTML",c),serviceData.GC.HTML=c}function sortCalendarResults(a,b){return new Date(a.start.dateTime||a.start.date)-new Date(b.start.dateTime||b.start.date)}