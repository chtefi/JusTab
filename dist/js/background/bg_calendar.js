"use strict";function getCalendarData(a){serviceData.GC.status&&chrome.identity.getAuthToken({interactive:!0},function(b){var c,d=[],e=[];serviceData.GC.calendars.forEach(function(a,b){c=encodeURIComponent(a),d.push("https://www.googleapis.com/calendar/v3/calendars/"+c+"/events"),e.push(a)}),eventArray(d,e,b,a)})}function eventArray(a,b,c,d){var e,f=(new Date).toISOString(),g=serviceData.GC.days,h=moment(new Date).add(g,"days").endOf("day").toISOString(),i=[],j=[];a.forEach(function(a,d){e=a+"?&oauth_token="+c+"&timeMin="+f+"&timeMax="+h+"&orderBy=startTime&singleEvents=true",j.push(ajax("GET",e).then(function(a){a.items.forEach(function(a,c){a.calendarId=b[d]}),localStorage.setItem("Calendar_error",!1),serviceData.GC.error=!1,i=i.concat(a.items)},function(a){localStorage.setItem("Calendar_error",!0),serviceData.GC.error=!0}))}),Promise.all(j).then(function(){i.length>0&&(localStorage.setItem("Calendar",JSON.stringify(i)),serviceData.GC.JSON=i),calendarHTML(),d&&d()})}function calendarHTML(){var a=serviceData.GC.JSON.sort(sortCalendarResults);htmlData="",eventDate="",a.forEach(function(a,b){moment(a.start.dateTime||a.start.date).isBefore(moment(),"day")?formattedDate="Today":formattedDate=moment(a.start.dateTime||a.start.date).calendar(),(moment(a.start.dateTime||a.start.date).isAfter(eventDate,"day")||""===eventDate)&&(htmlData+="<h2>"+formattedDate+"</h2>"),moment(a.start.dateTime||a.start.date).isBefore(moment(),"day")?eventDate=moment():eventDate=moment(a.start.dateTime||a.start.date),htmlData+='<div class="core-item gc-item"><div class="core-item-content">',a.start.dateTime?(eventStartTime=moment(a.start.dateTime).format("HH:mm"),eventEndTime=moment(a.end.dateTime).format("HH:mm"),htmlData+=htmlEncode(eventStartTime+" - "+eventEndTime+" "+a.summary)):htmlData+=htmlEncode(a.summary),htmlData+='</div><div class="core-item-icon"></div></div><div class="gc-collapse core-collapse">',a.location&&(htmlData+='<div class="gc-event-location">'+htmlEncode(a.location)+"</div>"),htmlData+='<div class="gc-icon-container"><div class="waves-effect gc-event-remove-icon remove-icon" data-event-id='+a.id+" data-calendar-id="+a.calendarId+'></div><a class="gc-event-link" href="'+a.htmlLink+'" target="_blank"><div class="waves-effect gc-event-link-icon edit-icon"></div></a></div></div>'}),localStorage.setItem("CalendarHTML",htmlData),serviceData.GC.HTML=htmlData}function sortCalendarResults(a,b){return new Date(a.start.dateTime||a.start.date)-new Date(b.start.dateTime||b.start.date)}