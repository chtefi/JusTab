function getCalendarData(a){chrome.identity.getAuthToken({interactive:!0},function(b){var c,d=[];$.each(serviceData.GC.calendars,function(a,b){c=encodeURIComponent(b),d.push("https://www.googleapis.com/calendar/v3/calendars/"+c+"/events")}),eventArray(d,b,a)})}function eventArray(a,b,c){dateNow=(new Date).toISOString(),daysShow=serviceData.GC.days,dateLast=moment(new Date).add(daysShow,"days").endOf("day").toISOString(),events=[],promises=[],$.each(a,function(c){promises.push($.ajax({url:a[c]+"?&oauth_token="+b+"&timeMin="+dateNow+"&timeMax="+dateLast+"&orderBy=startTime&singleEvents=true"}).done(function(a){localStorage.setItem("Calendar_error",!1),serviceData.GC.error=!1,events=$.merge(events,a.items)}).fail(function(a,b,c){console.log(a,b,c),localStorage.setItem("Calendar_error",!0),serviceData.GC.error=!0}))}),$.when.apply($,promises).done(function(){events.length>0&&(localStorage.setItem("Calendar",JSON.stringify(events)),serviceData.GC.JSON=events),calendarHTML(),c&&c()})}function calendarHTML(){var a=serviceData.GC.JSON.sort(sortCalendarResults);serviceData.GC.status&&(htmlData="",eventDate="",$.each(a,function(a,b){formattedDate=moment(b.start.dateTime||b.start.date).isBefore(moment(),"day")?"Today":moment(b.start.dateTime||b.start.date).calendar(),(moment(b.start.dateTime||b.start.date).isAfter(eventDate,"day")||""===eventDate)&&(htmlData+="<h2>"+formattedDate+"</h2>"),eventDate=moment(b.start.dateTime||b.start.date).isBefore(moment(),"day")?moment():moment(b.start.dateTime||b.start.date),htmlData+='<div class="core-item gc-item"><div class="core-item-content">',b.start.dateTime?(eventStartTime=moment(b.start.dateTime).format("HH:mm"),eventEndTime=moment(b.end.dateTime).format("HH:mm"),htmlData+=eventStartTime+" - "+eventEndTime+" "+b.summary):htmlData+=b.summary,htmlData+='</div><div class="core-item-icon"><div class="expand-more-icon"></div></div></div><div class="gc-collapse core-collapse">',b.location&&(htmlData+='<div class="gc-event-location">'+b.location+"</div>"),htmlData+='<a class="gc-event-link" href="'+b.htmlLink+'" target="_blank"><div class="waves-effect gc-event-link-icon edit-icon"></div></a></div>'}),localStorage.setItem("CalendarHTML",htmlData),serviceData.GC.HTML=htmlData)}function sortCalendarResults(a,b){return new Date(a.start.dateTime||a.start.date)-new Date(b.start.dateTime||b.start.date)}