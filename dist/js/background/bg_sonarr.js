function getSonarrData(a){var b=serviceData.SO.apiUrl,c=moment().subtract(7,"days").format("YYYY-MM-DD"),d=moment().add(1,"months").format("YYYY-MM-DD"),e="calendar?apikey="+serviceData.SO.key+"&start="+c+"&end="+d;$.ajax({url:b+e}).done(function(a){localStorage.setItem("Sonarr_error",!1),serviceData.SO.error=!1,localStorage.setItem("Sonarr",JSON.stringify(a)),serviceData.SO.JSON=a,soHTML()}).fail(function(a,b,c){console.log(a,b,c),localStorage.setItem("Sonarr_error",!0),serviceData.SO.error=!0}).always(function(){a&&a()})}function soHTML(){if(serviceData.SO.JSON){var a=serviceData.SO.JSON,b=headerHtml("Missed"),c=headerHtml("Today"),d=headerHtml("Tomorrow"),e=headerHtml("Soon"),f=headerHtml("Later");$.each(a,function(a,g){var h=moment().startOf("day"),i=moment(g.airDate,"YYYY-MM-DD"),j=i.diff(h,"days"),k=g.hasFile,l=g.monitored;!k&&l&&(0>j?b+=episodeHtml(g):0===j?c+=episodeHtml(g):1===j?d+=episodeHtml(g):j>1&&7>=j?e+=episodeHtml(g):f+=episodeHtml(g))}),HTML="",b!=headerHtml("Missed")&&(HTML+=b),c!=headerHtml("Today")&&(HTML+=c),d!=headerHtml("Tomorrow")&&(HTML+=d),e!=headerHtml("Soon")&&(HTML+=e),f!=headerHtml("Later")&&(HTML+=f),localStorage.setItem("SonarrHTML",HTML),serviceData.SO.HTML=HTML}}function headerHtml(a){return"<h2>"+a+"</h2>"}function episodeHtml(a){var b=a.series.tvdbId,c=$.grep(a.series.images,function(a){return"poster"===a.coverType})[0];return posterUrl=c.url,showname=a.series.title,season=a.seasonNumber,episode=a.episodeNumber,episodeString=" S"+(season<10?"0":"")+season+"E"+(episode<10?"0":"")+episode,date=moment(a.airDate).calendar(),episodeId=a.id,'<div class="so-item core-item"><div class="so-poster-container"><img class="so-poster" src="img/poster_fallback.png" data-original="'+posterUrl+'"></div><div class="core-item-content">'+showname+episodeString+'</div><div class="core-item-icon"><div class="expand-more-icon"></div></div></div><div class="so-collapse core-collapse"><div class="so-collapse-date">'+date+'</div><div class="so-collapse-buttons"><div class="icon-button search-icon so-search-episode waves-effect" data-episode-id="'+episodeId+'"></div><a class="so-tvdb-link" href="http://thetvdb.com/?tab=series&id='+b+'" target="_blank"><div class="icon-button info-icon so-tvdb-link-icon waves-effect"></div></a></div></div>'}