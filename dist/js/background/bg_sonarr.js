"use strict";function getSonarrData(a){var b=serviceData.SO.apiUrl,c=moment().subtract(7,"days").format("YYYY-MM-DD"),d=moment().add(1,"months").format("YYYY-MM-DD"),e="calendar?apikey="+serviceData.SO.key+"&start="+c+"&end="+d;ajax("GET",b+e).then(function(b){localStorage.setItem("Sonarr_error",!1),serviceData.SO.error=!1,localStorage.setItem("Sonarr",JSON.stringify(b)),serviceData.SO.JSON=b,soHTML(),a&&a()},function(){localStorage.setItem("Sonarr_error",!0),serviceData.SO.error=!0,a&&a()})}function soHTML(){if(serviceData.SO.JSON){var a=serviceData.SO.JSON,b=headerHtml("Missed"),c=headerHtml("Today"),d=headerHtml("Tomorrow"),e=headerHtml("Soon"),f=headerHtml("Later");a.forEach(function(a){var g=moment().startOf("day"),h=moment(a.airDate,"YYYY-MM-DD"),i=h.diff(g,"days"),j=a.hasFile,k=a.monitored;!j&&k&&(i<0?b+=episodeHtml(a):0===i?c+=episodeHtml(a):1===i?d+=episodeHtml(a):i>1&&i<=7?e+=episodeHtml(a):f+=episodeHtml(a))}),HTML="",b!=headerHtml("Missed")&&(HTML+=b),c!=headerHtml("Today")&&(HTML+=c),d!=headerHtml("Tomorrow")&&(HTML+=d),e!=headerHtml("Soon")&&(HTML+=e),f!=headerHtml("Later")&&(HTML+=f),localStorage.setItem("SonarrHTML",HTML),serviceData.SO.HTML=HTML}}function headerHtml(a){return"<h2>"+a+"</h2>"}function episodeHtml(a){var b=a.series.tvdbId,c=a.series.images.filter(function(a){return"poster"===a.coverType})[0];return posterUrl=c.url,showname=a.series.title,season=a.seasonNumber,episode=a.episodeNumber,episodeString=" S"+(season<10?"0":"")+season+"E"+(episode<10?"0":"")+episode,date=moment(a.airDate).calendar(),episodeId=a.id,'<div class="so-item core-item"><div class="so-poster-container"><img class="so-poster" src="img/poster_fallback.png" data-echo="'+posterUrl+'"></div><div class="core-item-content">'+htmlEncode(showname+episodeString)+'</div><div class="core-item-icon"></div></div><div class="so-collapse core-collapse"><div class="so-collapse-date">'+htmlEncode(date)+'</div><div class="so-collapse-buttons"><div class="icon-button search-icon so-search-episode waves-effect" data-episode-id="'+episodeId+'"></div><a class="so-tvdb-link" href="http://thetvdb.com/?tab=series&id='+b+'" target="_blank"><div class="icon-button info-icon so-tvdb-link-icon waves-effect"></div></a></div></div>'}