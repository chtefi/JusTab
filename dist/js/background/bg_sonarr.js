"use strict";function getSonarrData(a){var b=serviceData.SO.apiUrl,c=moment().subtract(7,"days").format("YYYY-MM-DD"),d=moment().add(1,"months").format("YYYY-MM-DD"),e="calendar?apikey="+serviceData.SO.key+"&start="+c+"&end="+d;ajax("GET",b+e).then(function(b){localStorage.setItem("Sonarr_error",!1),serviceData.SO.error=!1,localStorage.setItem("Sonarr",JSON.stringify(b)),serviceData.SO.JSON=b,soHTML(),a&&a()},function(){localStorage.setItem("Sonarr_error",!0),serviceData.SO.error=!0,a&&a()})}function soHTML(){if(serviceData.SO.JSON){var a=serviceData.SO.JSON,b=headerHtml("Missed"),c=headerHtml("Today"),d=headerHtml("Tomorrow"),e=headerHtml("Soon"),f=headerHtml("Later");a.forEach(function(a){var g=moment().startOf("day"),h=moment(a.airDate,"YYYY-MM-DD"),i=h.diff(g,"days"),j=a.hasFile,k=a.monitored;!j&&k&&(i<0?b+=episodeHtml(a):0===i?c+=episodeHtml(a):1===i?d+=episodeHtml(a):i>1&&i<=7?e+=episodeHtml(a):f+=episodeHtml(a))});var g="";b!=headerHtml("Missed")&&(g+=b),c!=headerHtml("Today")&&(g+=c),d!=headerHtml("Tomorrow")&&(g+=d),e!=headerHtml("Soon")&&(g+=e),f!=headerHtml("Later")&&(g+=f),localStorage.setItem("SonarrHTML",g),serviceData.SO.HTML=g}}function headerHtml(a){return"<h2>"+a+"</h2>"}function episodeHtml(a){var b=a.series.tvdbId,c=a.series.images.filter(function(a){return"poster"===a.coverType})[0],d=c.url,e=a.series.title,f=a.seasonNumber,g=a.episodeNumber,h=" S"+(f<10?"0":"")+f+"E"+(g<10?"0":"")+g,i=moment(a.airDate).calendar(),j=a.id;return'<div class="so-item core-item"><div class="so-poster-container"><img class="so-poster" src="img/poster_fallback.png" data-echo="'+d+'"></div><div class="core-item-content">'+htmlEncode(e+h)+'</div><div class="core-item-icon"></div></div><div class="so-collapse core-collapse"><div class="so-collapse-date">'+htmlEncode(i)+'</div><div class="so-collapse-buttons"><div class="icon-button search-icon so-search-episode waves-effect" data-episode-id="'+j+'"></div><a class="so-tvdb-link" href="http://thetvdb.com/?tab=series&id='+b+'" target="_blank"><div class="icon-button info-icon so-tvdb-link-icon waves-effect"></div></a></div></div>'}