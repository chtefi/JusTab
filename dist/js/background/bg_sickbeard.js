function getSickBeardData(a){var b=serviceData.SB.apiUrl,c="?cmd=future&sort=date&type=today|missed|soon|later";$.ajax({url:b+c}).done(function(a){localStorage.setItem("Sickbeard_error",!1),serviceData.SB.error=!1,localStorage.setItem("Sickbeard",JSON.stringify(a)),serviceData.SB.JSON=a,sbHTML()}).fail(function(a,b,c){console.log(a,b,c),localStorage.setItem("Sickbeard_error",!0),serviceData.SB.error=!0}).always(function(){a&&a()})}function sbHTML(){serviceData.SB.apiUrl;if(serviceData.SB.JSON){if(data=serviceData.SB.JSON,data.data.missed.length>0){var a="<h2>Missed</h2>";listSeries(data.data.missed,a,"SickbeardMissedHTML","MissedHTML")}else localStorage.removeItem("SickbeardMissedHTML"),delete serviceData.SB.MissedHTML;if(data.data.today.length>0){var b="<h2>Today</h2>";listSeries(data.data.today,b,"SickbeardTodayHTML","TodayHTML")}else localStorage.removeItem("SickbeardTodayHTML"),delete serviceData.SB.TodayHTML;if(data.data.soon.length>0){var c="<h2>Soon</h2>";listSeries(data.data.soon,c,"SickbeardSoonHTML","SoonHTML")}else localStorage.removeItem("SickbeardSoonHTML"),delete serviceData.SB.SoonHTML;if(data.data.later.length>0){var d="<h2>Later</h2>";listSeries(data.data.later,d,"SickbeardLaterHTML","LaterHTML")}else localStorage.removeItem("SickbeardLaterHTML"),delete serviceData.SB.LaterHTML}}function listSeries(a,b,c){$.each(a,function(a,c){var d,e=c.tvdbid,f=c.season,g=c.episode,h=c.airdate,i=c.show_name,j="http://thetvdb.com/banners/posters/"+e+"-1.jpg";d=moment(h).isSame(moment(),"day")?"Today":moment(h).isSame(moment().add(1,"day"),"day")?"Tomorrow":moment(h).isSame(moment().subtract(1,"day"),"day")?"Yesterday":moment(h).format(moment(h).year()>moment().year()?"MMM D, YYYY":"MMM D");var k=" S"+(10>f?"0":"")+f+"E"+(10>g?"0":"")+g;b+='<div class="sb-item core-item"><div class="sb-poster-container"><img class="sb-poster" src="img/poster_fallback.png" data-src="'+j+'"></div><div class="core-item-content">'+i+k+'</div><div class="core-item-icon"><div class="expand-more-icon"></div></div></div><div class="sb-collapse core-collapse">'+d+"<div class='sb-collapse-buttons'><div class='icon-button search-icon sb-search-episode waves-effect' data-tvdbid='"+e+"' data-season='"+f+"' data-episode='"+g+"'></div><a class='sb-tvdb-link' href='http://thetvdb.com/?tab=series&id="+e+"' target='_blank'><div class='icon-button info-icon sb-tvdb-link-icon waves-effect'></div></a><div class='icon-button done-icon sb-mark-episode waves-effect' data-tvdbid='"+e+"' data-season='"+f+"' data-episode='"+g+"'></div></div></div>"}),localStorage.setItem(c,b),serviceData.SB[c]=b}