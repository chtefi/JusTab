"use strict";function observeDOM(a,b){var c=window.MutationObserver||window.WebKitMutationObserver,d=window.addEventListener;if(c){var e=new c(function(a,c){(a[0].addedNodes.length||a[0].removedNodes.length)&&b()});e.observe(a,{childList:!0,subtree:!0})}else d&&(a.addEventListener("DOMNodeInserted",b,!1),a.addEventListener("DOMNodeRemoved",b,!1))}function findHistory(a){var b=a.getAttribute("href");chrome.history.getVisits({url:b},function(a){0===a.length&&window.open(b)})}function showActiveServices(a){var b,c=0;for(var d in a){var b=a[d].status;if(b){var e="#"+a[d].containerId,f="."+a[d].containerId+"-info",g=a[d].panelWidth,h=document.querySelectorAll(e+", "+f);window[a[d].feFunctionName](),c+=g||400;var i=!0,j=!1,k=void 0;try{for(var l,m=h[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){var n=l.value;n.style.width=g+"px",n.style.display="block"}}catch(a){j=!0,k=a}finally{try{!i&&m.return&&m.return()}finally{if(j)throw k}}}}document.querySelector("body").style.width=c+"px",document.querySelector(".bottom-bar-container").style.width=c+"px"}function sortServices(a,b){var c,d,e=localStorage.getItem("serviceOrder").split(",");e.forEach(function(e){c=a.querySelector('[data-service-id="'+e+'"]'),c&&a.appendChild(c),d=b.querySelector('[data-service-id="'+e+'"]'),d&&b.appendChild(d)})}function refreshService(a,b){var c=a.target.closest(".panel"),d=c.querySelector(".refresh-button"),e=d.querySelector(".waves-ripple");e&&d.removeChild(e);var f=d.innerHTML;c.querySelector(".error").style.maxHeight="0",replaceContent(d,serviceData.spinner).then(function(){runBackgroundFunction(b,f).then(function(){replaceContent(d,f)})})}function runBackgroundFunction(a){return new Promise(function(b,c){chrome.runtime.getBackgroundPage(function(c){a.forEach(function(a){var d=a.name,e=a.param;e?c[d](e,function(){b()}):c[d](function(){b()})})})})}function checkError(a,b){var c=localStorage.getItem(b),d=document.querySelector("#"+a+" .error");"true"==c&&(d.style.maxHeight="120px"),"false"==c&&(d.style.maxHeight="0")}function replaceContent(a,b){return new Promise(function(c,d){var e=300;a.style.opacity=0,setTimeout(function(){a.innerHTML=b,a.style.opacity=1,setTimeout(function(){c()},e)},e)})}serviceDataRefreshDone.then(function(){localStorage.getItem("serviceOrder")&&sortServices(document.querySelector(".panel-container"),document.querySelector(".bottom-bar-container")),showActiveServices(serviceData);var a=document.querySelectorAll("img"),b=!0,c=!1,d=void 0;try{for(var e,f=a[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;g.setAttribute("draggable",!0)}}catch(a){c=!0,d=a}finally{try{!b&&f.return&&f.return()}finally{if(c)throw d}}var h=document.querySelector(".settings-button");h.addEventListener("click",function(a){chrome.tabs.create({url:chrome.extension.getURL("options.html")})});var i=document.querySelectorAll(".error-settings-button"),j=!0,k=!1,l=void 0;try{for(var m,n=i[Symbol.iterator]();!(j=(m=n.next()).done);j=!0){var o=m.value;o.addEventListener("click",function(a){var b=a.target.closest(".panel").getAttribute("id");chrome.tabs.create({url:chrome.extension.getURL("options.html")+"#"+b})})}}catch(a){k=!0,l=a}finally{try{!j&&n.return&&n.return()}finally{if(k)throw l}}var p=document.querySelectorAll(".error-retry-button"),q=!0,r=!1,s=void 0;try{for(var t,u=p[Symbol.iterator]();!(q=(t=u.next()).done);q=!0){var v=t.value;v.addEventListener("click",function(a){var b=a.target.closest(".panel").querySelector(".refresh-button");b.click()})}}catch(a){r=!0,s=a}finally{try{!q&&u.return&&u.return()}finally{if(r)throw s}}var w=document.querySelectorAll(".open-all"),x=!0,y=!1,z=void 0;try{for(var A,B=w[Symbol.iterator]();!(x=(A=B.next()).done);x=!0){var C=A.value;C.addEventListener("click",function(a){var b=a.target.closest(".bottom-bar-part").getAttribute("data-service-id"),c=document.querySelector('.panel[data-service-id="'+b+'"]'),d=c.querySelectorAll(".service-link"),e=!0,f=!1,g=void 0;try{for(var h,i=d[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value;findHistory(j)}}catch(a){f=!0,g=a}finally{try{!e&&i.return&&i.return()}finally{if(f)throw g}}})}}catch(a){y=!0,z=a}finally{try{!x&&B.return&&B.return()}finally{if(y)throw z}}var D=document.querySelectorAll(".refresh-button"),E=!0,F=!1,G=void 0;try{for(var H,I=D[Symbol.iterator]();!(E=(H=I.next()).done);E=!0){var J=H.value;J.addEventListener("click",function(a){var b=this.getAttribute("class").split(" ").filter(function(a){return"refresh-button"!=a&&"waves-effect"!=a})[0].replace("refresh-","").toUpperCase(),c=serviceData[b];if(c.status){var d=getObjects(c,"bgFunctionName",""),e=[];d.forEach(function(a){var b={name:a.bgFunctionName};a.length&&(b.param=a.length),e.push(b)}),refreshService(a,e)}})}}catch(a){F=!0,G=a}finally{try{!E&&I.return&&I.return()}finally{if(F)throw G}}echo.init({offset:100,throttle:250,unload:!1});var K=document.querySelectorAll(".panel"),L=!0,M=!1,N=void 0;try{for(var O,P=K[Symbol.iterator]();!(L=(O=P.next()).done);L=!0){var Q=O.value;Q.addEventListener("scroll",function(){echo.render()},!0);var R=Q.querySelector(".panel-content");observeDOM(R,function(){echo.render()})}}catch(a){M=!0,N=a}finally{try{!L&&P.return&&P.return()}finally{if(M)throw N}}window.addEventListener("storage",function(a){var b=a.key,c=getObjects(serviceData,"htmlStorageKey",b);if(c.length>0){var d=c[0].feFunctionName;d&&chrome.runtime.sendMessage({changedStorageKey:b,storageFunctionName:d})}})}),chrome.runtime.onMessage.addListener(function(a,b,c){refreshServiceData(),serviceDataRefreshDone.then(function(){if(a.changedStorageKey.indexOf("_error")!=-1){var b=a.changedStorageKey.replace("_error","").toLowerCase();return void checkError(b,a.changedStorageKey)}a.storageFunctionName&&window[a.storageFunctionName]()})});